## ğŸ“‹ PIPLINE_3: ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ç”Ÿæˆã¾ã§ã®å®Œå…¨ãªãƒ—ãƒ­ã‚»ã‚¹ï¼ˆãƒˆãƒ¬ãƒ¼ã‚¹è¿½è·¡ç‰ˆï¼‰

`docs/PIPLINE_3.md` ã®å†…å®¹ã‚’ã€`docs/PIPLINE_2_è§£èª¬.md` ã¨åŒã˜å½¢å¼ï¼ˆå·¥ç¨‹ã”ã¨ã®ç›®çš„ / input-output / å¤‰æ›å†…å®¹ã‚’å…·ä½“ä¾‹ã§è¿½ã†ï¼‰ã§è§£èª¬ã—ã¾ã™ã€‚

---

### ãƒˆãƒ¬ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ï¼ˆPIPLINE_3 / æœ€å¤§9ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

ä¾‹: `EVERYTIME-LOG/trace/2026-02-06/004450-885721/`

```
EVERYTIME-LOG/trace/2026-02-06/004450-885721/
â”œâ”€â”€ run.json                        # Step 0: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ stage-00.raw.jsonl              # Step 1: ç”Ÿãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼ˆeventãƒ©ãƒƒãƒ—ï¼‰
â”œâ”€â”€ stage-01.entities.jsonl         # Step 2: ç‰¹å¾´æŠ½å‡ºï¼ˆactive-first + ocr_by_displayä¿æŒï¼‰
â”œâ”€â”€ stage-02.segment.jsonl          # Step 3: ã‚»ã‚°ãƒ¡ãƒ³ãƒˆä»˜ä¸ï¼ˆsegment_id/labelï¼‰
â”œâ”€â”€ stage-03.segment.jsonl          # Step 4: ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†…OCRçµ±åˆï¼ˆæ–‡/è¡Œã§é‡è¤‡é™¤å» + common_textsåˆ†é›¢ï¼‰
â”œâ”€â”€ stage-04.hour-pack.jsonl        # Step 5: 1æ™‚é–“ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ / LLMå…¥åŠ›ï¼‰
â”œâ”€â”€ stage-05.hour-llm.jsonl         # Step 6: 1æ™‚é–“è¦ç´„ï¼ˆLLMå‡ºåŠ›ï¼‰
â”œâ”€â”€ stage-06.daily-llm.json         # Step 7: 1æ—¥ç·æ‹¬ï¼ˆLLMå‡ºåŠ› / JSONï¼‰
â””â”€â”€ stage-07.hour-enrich-llm.jsonl  # Step 8: æ™‚é–“å¸¯ã®ç›®çš„ãƒ»æ„å‘³ã®å†è§£é‡ˆï¼ˆLLMå‡ºåŠ›ï¼‰
```

### æœ€çµ‚ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆï¼ˆMarkdownï¼‰

ä¾‹ï¼ˆrun_id é…ä¸‹ã«ä¿å­˜ã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ï¼‰:

```
EVERYTIME-LOG/out/2026-02-06/004450-885721/26-02-06_Everlogèµ·å‹•ã¨LLMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã®å…¨æ—¥æ¤œè¨.md
```

**ãƒ•ã‚¡ã‚¤ãƒ«åã®å½¢å¼**: `<yy-mm-dd>_<daily_title>.md`
- `daily_title` ãŒå–å¾—ã§ããªã„å ´åˆã¯ `<yy-mm-dd>_ä½œæ¥­ãƒ­ã‚°.md`
- `out/<date>.md` ã¸ã®ç›´æ¥å‡ºåŠ›ã¯å»ƒæ­¢ã•ã‚Œã€å¸¸ã« `out/<date>/<run_id>/` ã«æ ¼ç´ã•ã‚Œã‚‹

#### âœ… å®‰å…¨ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆæ¼ãˆã„å¯¾ç­– / æœ€çµ‚å‡ºåŠ›ã®ã¿ï¼‰
æœ€çµ‚Markdownã¯åŸºæœ¬çš„ã«ãƒ­ãƒ¼ã‚«ãƒ«ã§è‡ªåˆ†ã ã‘ãŒè¦‹ã‚‹æƒ³å®šã ãŒã€ä¸‡ãŒä¸€ã©ã“ã‹ã«æ¼ã‚ŒãŸå ´åˆã«å‚™ãˆã¦ã€
**Markdownç”Ÿæˆã®æœ€çµ‚æ®µï¼ˆæ›¸ãå‡ºã—ç›´å‰ï¼‰ã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ‹ã‚¿ã‚¤ã‚º**ã‚’ã‹ã‘ã‚‹ã€‚

- **ç›®çš„**: `docs/PRIVACY-CONTENTS.md` ã«ã‚ã‚‹ã‚ˆã†ãªã€Œå¼¾ã‹ã‚Œã‚„ã™ã„/å±é™ºã«ãªã‚Šã‚„ã™ã„æƒ…å ±ã€ã‚’æœ€çµ‚æˆæœç‰©ã‹ã‚‰è½ã¨ã™
- **é©ç”¨ç¯„å›²**: æœ€çµ‚Markdownï¼ˆãŠã‚ˆã³ NotionåŒæœŸã§ä½¿ã†ã‚¿ã‚¤ãƒˆãƒ«ï¼‰
- **éé©ç”¨ç¯„å›²**: stage-00ã€œstage-04ï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹åŠ å·¥æ®µéšï¼‰ãªã©ã®ãƒ­ãƒ¼ã‚«ãƒ«ä¸­é–“ãƒ‡ãƒ¼ã‚¿
- **åˆ¶å¾¡**: `EVERLOG_SAFE_MARKDOWN`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæœ‰åŠ¹ã€ç„¡åŠ¹åŒ–ã¯ `EVERLOG_SAFE_MARKDOWN=0`ï¼‰

ãƒã‚¹ã‚¯ä¾‹ï¼ˆä»£è¡¨ï¼‰:
- å€‹äººæƒ…å ±/èªè¨¼æƒ…å ±ï¼ˆãƒ¡ãƒ¼ãƒ«/é›»è©±/ã‚«ãƒ¼ãƒ‰/OTP/ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¿‘å‚ï¼‰
- å…¸å‹çš„ãªAPIã‚­ãƒ¼/ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆ`sk-...`ã€GitHub/Slackãƒˆãƒ¼ã‚¯ãƒ³ã€JWT ç­‰ï¼‰
- ç§˜å¯†éµãƒ–ãƒ­ãƒƒã‚¯ï¼ˆ`BEGIN ... PRIVATE KEY`ï¼‰

---

## ğŸ”„ ã‚¹ãƒ†ãƒ¼ã‚¸åˆ¥ãƒ‡ãƒ¼ã‚¿å¤‰æ›ï¼ˆå…·ä½“ä¾‹ã¤ãï¼‰

å¯¾è±¡ã‚¤ãƒ™ãƒ³ãƒˆ:
- `event_id: 40016d1e-4804-45c3-9b34-b59eae095842`
- `ts: 2026-02-06T00:00:44+09:00`
- `active_app: Google Chrome`
- `active_display: 2`

---

### **Step 0: run.jsonï¼ˆãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼‰**

**ç›®çš„**: ã“ã®ãƒˆãƒ¬ãƒ¼ã‚¹ä¸€å¼ã®ã€Œã„ã¤/ã©ã®å®Ÿè¡Œã€ã§ç”Ÿæˆã•ã‚ŒãŸã‹ã‚’è¨˜éŒ²ã™ã‚‹

**å…¥åŠ›**: ãªã—ï¼ˆå®Ÿè¡Œæ™‚æƒ…å ±ã‹ã‚‰ç”Ÿæˆï¼‰

**å‡ºåŠ›**: `trace/<date>/<run_id>/run.json`

```json
{
  "run_id": "004450-885721",
  "source": "summarize",
  "started_at": "2026-02-07T00:xx:xx+09:00"
}
```

---

### **Step 1: stage-00.raw.jsonlï¼ˆç”Ÿãƒ‡ãƒ¼ã‚¿ä¿å­˜ / eventãƒ©ãƒƒãƒ—ï¼‰**

**ç›®çš„**: å…ƒãƒ­ã‚°ã‚’ã€Œä¸€åˆ‡è½ã¨ã•ãšã€ãƒˆãƒ¬ãƒ¼ã‚¹ã«ä¿å­˜ã™ã‚‹ï¼ˆå¾Œã‹ã‚‰æ¤œè¨¼ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼‰

**å…¥åŠ›**: `EVERYTIME-LOG/logs/2026-02-06.jsonl`

**å‡ºåŠ›**: `trace/2026-02-06/004450-885721/stage-00.raw.jsonl`

**åŠ å·¥å†…å®¹**: 1è¡Œ=1ã‚¤ãƒ™ãƒ³ãƒˆã‚’ `{"event": <å…ƒã‚¤ãƒ™ãƒ³ãƒˆ>}` ã§ãƒ©ãƒƒãƒ—ã—ã¦ä¿å­˜

```json
{
  "event": {
    "id": "40016d1e-4804-45c3-9b34-b59eae095842",
    "ts": "2026-02-06T00:00:44+09:00",
    "active_app": "Google Chrome",
    "window_title": "Pricing | OpenAI API",
    "active_display": 2,
    "ocr_active_display_text": "â€¢â€¢â€¢\nâ†\næ˜­\nâ†’\n...(é•·ã„OCR)...",
    "ocr_by_display": [
      {"display": 2, "ocr_text": "...", "excluded": false, "image": "..."},
      {"display": 3, "ocr_text": "...", "excluded": false, "image": "..."},
      {"display": 1, "ocr_text": "...", "excluded": false, "image": "..."}
    ],
    "excluded": false
  }
}
```

---

### **Step 2: stage-01.entities.jsonlï¼ˆç‰¹å¾´æŠ½å‡º / active-first + ocr_by_displayä¿æŒï¼‰**

**ç›®çš„**:
- ã€ŒActive Display Firstã€ã‚’ç¶­æŒã—ã¤ã¤ã€**éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç”»é¢ã®OCRã‚‚çœç•¥ã›ãšä¿æŒ**ã™ã‚‹
- å¾Œå·¥ç¨‹ï¼ˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆåŒ–/é‡è¤‡é™¤å»/æ™‚é–“ãƒ‘ãƒƒã‚­ãƒ³ã‚°ï¼‰ã«å¿…è¦ãª â€œç‰¹å¾´é‡â€ ã‚’ä½œã‚‹

**å…¥åŠ›**: `stage-00.raw.jsonl`ï¼ˆeventï¼‰

**å‡ºåŠ›**: `trace/2026-02-06/004450-885721/stage-01.entities.jsonl`

**ä¸»ãªå¤‰æ›å†…å®¹**:
- **ã‚­ãƒ¼æ•´ç†**: `id` â†’ `event_id`
- **segment_key ã®ä½œæˆ**: `[active_app, domain, window_title]`
- **primary_source**:
  - `active_display`: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç”»é¢ã®OCRãŒä½¿ãˆãŸ
  - `fallback_all_displays`: ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãŒç©ºã§ã€éé™¤å¤–displayã®çµåˆã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
  - `fallback_empty`: OCRã‹ã‚‰ä¸»ãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œã‚Œãªã‹ã£ãŸ
- **ocr_by_display ã‚’ä¿æŒ**ï¼ˆé‡è¦ï¼‰:
  - ä½™è¨ˆãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è½ã¨ã—ã€`display`, `ocr_text`, `is_active_display` ã®ã¿ã«æ­£è¦åŒ–
  - `ocr_text` ã¯æ”¹è¡Œã‚’ç©ºç™½ã«ç½®æ›ã—ã¦æ­£è¦åŒ–ï¼ˆä¾‹: `"a\nb"` â†’ `"a b"`ï¼‰
- **urls / paths æŠ½å‡º**: ä¸»ã« primary_textï¼ˆactiveå„ªå…ˆï¼‰ã‹ã‚‰æŠ½å‡º

```json
{
  "event_id": "40016d1e-4804-45c3-9b34-b59eae095842",
  "ts": "2026-02-06T00:00:44+09:00",
  "active_app": "Google Chrome",
  "window_title": "Pricing | OpenAI API",
  "domain": "platform.openai.com",
  "segment_key": ["Google Chrome", "platform.openai.com", "Pricing | OpenAI API"],
  "primary_source": "active_display",
  "ocr_by_display": [
    {"display": 2, "ocr_text": "â€¢â€¢â€¢ â† æ˜­ â†’ ... Pricing ...", "is_active_display": true},
    {"display": 3, "ocr_text": "A ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ ... capture.py ... summarize.py ...", "is_active_display": false},
    {"display": 1, "ocr_text": "AK Slack ... tokenæ•°ã¨ãƒ—ãƒ©ã‚¤ã‚·ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«ã§è¨ˆç®— ...", "is_active_display": false}
  ],
  "urls": ["platform.openal.com/docs/pricing?latest-pricing=priority"],
  "paths": []
}
```

---

### **Step 3: stage-02.segment.jsonlï¼ˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆä»˜ä¸ï¼‰**

**ç›®çš„**: é€£ç¶šã‚¤ãƒ™ãƒ³ãƒˆã‚’ã¾ã¨ã‚ã¦ã€Œã‚»ã‚°ãƒ¡ãƒ³ãƒˆåŒ–ã€ã—ã€å¾Œå·¥ç¨‹ã§æ‰±ã„ã‚„ã™ãã™ã‚‹

**å…¥åŠ›**: `stage-01.entities.jsonl`

**å‡ºåŠ›**: `trace/2026-02-06/004450-885721/stage-02.segment.jsonl`

**å¤‰æ›å†…å®¹**:
- ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚­ãƒ¼ï¼ˆåŸºæœ¬ï¼‰: `(active_app, domain, window_title)`
- åŒä¸€ã‚­ãƒ¼ãŒé€£ç¶šã™ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã«åŒã˜ `segment_id` ã‚’å‰²ã‚Šå½“ã¦ã‚‹
- äººé–“ãŒèª­ã‚ã‚‹ `segment_label` ã‚’ä»˜ä¸ã™ã‚‹ï¼ˆä¾‹: `app / domain / window_title`ï¼‰

```diff
{
  "event_id": "40016d1e-4804-45c3-9b34-b59eae095842",
  "segment_key": ["Google Chrome", "platform.openai.com", "Pricing | OpenAI API"],
  ...
+ "segment_id": 0,
+ "segment_label": "Google Chrome / platform.openai.com / Pricing | OpenAI API"
}
```

â€»è£œè¶³: ç¾çŠ¶ã®ãƒˆãƒ¬ãƒ¼ã‚¹å®Ÿè£…ã§ã¯ `stage-01.entities.jsonl` ã«ã‚‚ `segment_id/segment_label` ãŒå«ã¾ã‚Œã¾ã™ãŒã€æ¦‚å¿µä¸Šã¯ã“ã®å·¥ç¨‹ï¼ˆstage-02ï¼‰ã§ç¢ºå®šã—ãŸã‚‚ã®ã¨ã—ã¦æ‰±ã„ã¾ã™ã€‚

---

### **Step 4: stage-03.segment.jsonlï¼ˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†…OCRçµ±åˆ / é‡è¤‡é™¤å»ï¼‰**

**ç›®çš„**:
- `segment_id` ã”ã¨ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’é›†ç´„ã—ã€**LLMå‰ã®â€œèª­ã¿ã‚„ã™ã„OCRâ€** ã«æ•´å½¢ã™ã‚‹
- displayå˜ä½ã®å€‹åˆ¥æ€§ï¼ˆ`display`, `is_active_display`ï¼‰ã‚’ç¶­æŒã—ãŸã¾ã¾ã€**é‡è¤‡æ–‡ã‚’å‰Šã‚‹**
- ç¹°ã‚Šè¿”ã—å‡ºã‚‹ â€œå…±é€šãƒã‚¤ã‚ºâ€ ã‚’ `common_texts` ã¨ã—ã¦åˆ†é›¢ã—ã€èƒŒæ™¯æƒ…å ±ã«å›ã™

**å…¥åŠ›**: `stage-02.segment.jsonl`ï¼ˆè¤‡æ•°è¡Œï¼‰

**å‡ºåŠ›**: `trace/2026-02-06/004450-885721/stage-03.segment.jsonl`

**å‡¦ç†å†…å®¹ï¼ˆãƒ«ãƒ¼ãƒ«ï¼‰**:
- åˆ†å‰²å˜ä½:
  - å„ªå…ˆ: å¥èª­ç‚¹ï¼ˆ`ã€‚.!?ï¼ï¼Ÿ`ï¼‰ã§åˆ†å‰²
  - è£œåŠ©: `â–¶` / `â†’` / `ãƒ»` / `|` / `â€¢` ã¯ `ã€‚` æ‰±ã„ã«ã—ã¦åˆ†å‰²
  - ãã‚Œã§ã‚‚åˆ†å‰²ã§ããªã„å ´åˆã®ã¿ã€ç©ºç™½ã§åˆ†å‰²
- é‡è¤‡é™¤å»:
  - **segmentç´¯ç©**ã§ã€åŒä¸€displayå†…ã®â€œåŒã˜æ–‡ï¼ˆæ­£è¦åŒ–å¾Œï¼‰â€ã‚’1å›ã«ã™ã‚‹
  - æ–°è¦æ–‡ãŒ0ã®eventã¯ã€Œå…ˆé ­1æ–‡ã ã‘ã€æ®‹ã™ï¼ˆå®Œå…¨ç©ºã«ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼‰
- `common_texts`:
  - åŒä¸€displayã§ **2å›ä»¥ä¸Š** å‡ºãŸæ–‡ã‚’ â€œé »å‡ºæ–‡â€ ã¨ã—ã¦åˆ†é›¢ï¼ˆä¸Šé™20ï¼‰

**å‡ºåŠ›ä¾‹ï¼ˆsegment_id: 0ï¼‰**:

```json
{
  "segment_id": 0,
  "segment_key": ["Google Chrome", "platform.openai.com", "Pricing | OpenAI API"],
  "hour_start_ts": "2026-02-06T00:00:44+09:00",
  "hour_end_ts": "2026-02-06T00:01:57+09:00",
  "ocr_by_display": [
    {
      "display": 2,
      "events": [
        {"event_id": "40016d1e-...", "ts": "2026-02-06T00:00:44+09:00", "is_active_display": true, "ocr_text": "ã€‚ã€‚ã€‚"},
        {"event_id": "21006f5a-...", "ts": "2026-02-06T00:01:57+09:00", "is_active_display": true, "ocr_text": "ã€‚ã€‚ã€‚"}
      ],
      "common_texts": [
        "Pricing Text tokens Models Pricing Libraries MODEL gpt-5.2 ...",
        "For lower prices with higher latency, try the ...",
        "...(é »å‡ºã—ãŸUIãƒ†ã‚­ã‚¹ãƒˆ/è¡¨ã®è¡Œãªã©)..."
      ]
    },
    {
      "display": 3,
      "events": [
        {"event_id": "40016d1e-...", "ts": "2026-02-06T00:00:44+09:00", "is_active_display": false, "ocr_text": "capture.py ... segments.py ... summarize.py ..."},
        {"event_id": "21006f5a-...", "ts": "2026-02-06T00:01:57+09:00", "is_active_display": false, "ocr_text": "capture.py ... segments.py ... summarize.py ..."}
      ],
      "common_texts": ["...ï¼ˆé »å‡ºæ–‡ã®åˆ†é›¢çµæœï¼‰..."]
    }
  ]
}
```

---

### **Step 5: stage-04.hour-pack.jsonlï¼ˆ1æ™‚é–“ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åŒ– / ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼‰**

**ç›®çš„**:
- LLMå…¥åŠ›ã‚’ **ã€Œ1æ™‚é–“ã€å˜ä½** ã«å›ºå®šã™ã‚‹
- èƒŒæ™¯æƒ…å ±ï¼ˆå…±é€šãƒã‚¤ã‚ºï¼‰ã‚’ **hour_common_texts** ã«åœ§ç¸®
- â€œé‡è¦ãªä½œæ¥­â€ ã ã‘ã‚’ LLM ã«æ¸¡ã™ãŸã‚ã€**ã‚¯ãƒ©ã‚¹ã‚¿ï¼ˆsegment_keyå˜ä½ï¼‰ã‚’ä¸Šä½3ã¤ã«çµã‚‹**

**å…¥åŠ›**: `stage-03.segment.jsonl`

**å‡ºåŠ›**: `trace/2026-02-06/004450-885721/stage-04.hour-pack.jsonl`

**å¤‰æ›å†…å®¹**:
- `hour_common_texts`:
  - `common_texts` ã‚’ hourå†…ã§é›†è¨ˆã—ã€é »å‡ºä¸Šä½20ä»¶ã ã‘æ¡ç”¨
  - ã‚«ã‚¦ãƒ³ãƒˆã¯ **(segment_id, display, text)** ã”ã¨ã«1å›ï¼ˆåŒã˜å·¨å¤§ãƒ†ã‚­ã‚¹ãƒˆã®éå¤§è©•ä¾¡ã‚’é˜²ãï¼‰
- `clusters[]`:
  - hourå†…ã® `segment_key` ã‚’ã¾ã¨ã‚ã‚‹
  - `is_active_display=true` ã® event ã ã‘ã‚’ `active_timeline` ã«æ®‹ã™ï¼ˆæ™‚ç³»åˆ—ã®éª¨ï¼‰
  - **active_secï¼ˆæ¨å®šä½œæ¥­æ™‚é–“ï¼‰ãŒé•·ã„ä¸Šä½3** ã®ã‚¯ãƒ©ã‚¹ã‚¿ã®ã¿æ®‹ã™

```json
{
  "hour_start_ts": "2026-02-06T00:00:00+09:00",
  "hour_end_ts": "2026-02-06T00:59:59+09:00",
  "active_sec_est": 720,
  "hour_common_texts": [
    "APIä½¿ã£ãŸãƒ­ã‚°æ©Ÿæ§‹ä½œã£ã¦ã‚‹ã‚“ã§ã™ãŒã€1å›èµ°ã‚‰ã›ã‚‹ã”ã¨ã«ã„ãã‚‰ã‹ã‹ã‚‹ã®ã‹ã‚ã‹ã‚‰ ãšã€‚ã€‚",
    "Pricing Text tokens Models Pricing Libraries MODEL gpt-5.2 ...",
    "...(ä¸Šä½20ã¾ã§)..."
  ],
  "clusters": [
    {
      "segment_key": ["Finder", "", ""],
      "segment_ids": [1],
      "active_timeline": [
        {"ts": "2026-02-06T00:03:10+09:00", "segment_id": 1, "ocr_text": "ameer ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›† ... (active displayã®å·®åˆ†OCR)"},
        {"ts": "2026-02-06T00:04:21+09:00", "segment_id": 1, "ocr_text": "..."}
      ]
    },
    {
      "segment_key": ["Google Chrome", "platform.openai.com", "Pricing | OpenAI API"],
      "segment_ids": [0],
      "active_timeline": [
        {"ts": "2026-02-06T00:00:44+09:00", "segment_id": 0, "ocr_text": "ã€‚ã€‚ã€‚"},
        {"ts": "2026-02-06T00:01:57+09:00", "segment_id": 0, "ocr_text": "ã€‚ã€‚ã€‚"}
      ]
    }
  ]
}
```

---

### **Step 6: stage-05.hour-llm.jsonlï¼ˆLLM: 1æ™‚é–“è¦ç´„ï¼‰**

**ç›®çš„**: `stage-04.hour-pack.jsonl` ã‚’å…¥åŠ›ã«ã€1æ™‚é–“ã«ã¤ã1ã¤ã®è‡ªç„¶æ–‡è¦ç´„ã‚’ç”Ÿæˆã™ã‚‹

**å…¥åŠ›**: `stage-04.hour-pack.jsonl`

**å‡ºåŠ›**: `trace/2026-02-06/004450-885721/stage-05.hour-llm.jsonl`

**LLMã®èª­ã¿æ–¹ï¼ˆæ„å›³ï¼‰**:
- `clusters[].active_timeline[]` ã‚’ä¸»å…¥åŠ›ï¼ˆæ™‚ç³»åˆ—ã®éª¨ï¼‰
- `hour_common_texts` ã¯èƒŒæ™¯ã¨ã—ã¦å‚ç…§ï¼ˆæœ¬æ–‡ã«ç¾…åˆ—ã—ãªã„ï¼‰

```json
{
  "hour_start_ts": "2026-02-06T00:00:00+09:00",
  "hour_end_ts": "2026-02-06T00:59:59+09:00",
  "hour_title": "Everlogèµ·å‹•ã¨åˆæœŸç¢ºèª",
  "hour_summary": "ãƒ­ã‚°æ©Ÿæ§‹ã®èµ·å‹•ã¨Everlogæœ¬ä½“ã®é…ç½®å ´æ‰€ã‚’ç¢ºèªã™ã‚‹ä½œæ¥­ã‚’é€²ã‚ãŸã€‚...",
  "hour_detail": "è¦³æ¸¬ã¨ã—ã¦ã¯Everlogã®å®Ÿä½“ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å‚ç…§ã™ã‚‹å ´é¢ãŒå¤šã‹ã£ãŸã€‚...(ä¸­ç•¥)... æ¨æ¸¬ã¨ã—ã¦ã¯...",
  "confidence": 0.65,
  "evidence": ["~/DEV/everytimecapture/.../everLog", "stage-00.raw.jsonl", "..."]
}
```

---

### **Step 7: stage-06.daily-llm.jsonï¼ˆLLM: 1æ—¥ç·æ‹¬ï¼‰**

**ç›®çš„**: `stage-05.hour-llm.jsonl`ï¼ˆå…¨hoursï¼‰ã‚’å…¥åŠ›ã«ã€**1æ—¥å…¨ä½“ã®ç·æ‹¬**ã‚’ç”Ÿæˆã™ã‚‹

**å…¥åŠ›**: `stage-05.hour-llm.jsonl`

**å‡ºåŠ›**: `trace/2026-02-06/004450-885721/stage-06.daily-llm.json`ï¼ˆâ€»JSON / 1ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

```json
{
  "date": "2026-02-06",
  "model": "gpt-5-nano",
  "generated_at": "2026-02-07T00:53:01.238496+09:00",
  "hour_count": 14,
  "daily": {
    "daily_title": "Everlogèµ·å‹•ã¨LLMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã®å…¨æ—¥æ¤œè¨",
    "daily_summary": "æœ¬æ—¥ã€Everlogã®èµ·å‹•ç¢ºèªã¨ãƒ­ã‚°åé›†åŸºç›¤ã®æ•´ç†ã‹ã‚‰ä½œæ¥­ã‚’é–‹å§‹ã—ãŸã€‚...",
    "daily_detail": "0æ™‚å°ã¯Everlogã®èµ·å‹•ã¨åˆæœŸè¨­å®šã®ç¢ºèªã‚’ä¸­å¿ƒã«...(ä¸­ç•¥)...",
    "highlights": ["Everlogèµ·å‹•ç¢ºèªã¨ãƒ­ã‚°ä¿å­˜å…ˆã®æ•´ç†ã‚’å®Œäº†", "..."],
    "confidence": 0.6,
    "evidence": ["Everlogèµ·å‹•ã¨æ¢ç´¢", "Notion/Docså‚ç…§ã¨ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¤œè¨", "..."]
  },
  "run_id": "004450-885721"
}
```

---

### **Step 8: stage-07.hour-enrich-llm.jsonlï¼ˆLLM: æ™‚é–“å¸¯ã®ç›®çš„ãƒ»æ„å‘³ã®å†è§£é‡ˆï¼‰**

**ç›®çš„**: `stage-06.daily-llm.json`ï¼ˆ1æ—¥ç·æ‹¬ï¼‰ã‚’è¸ã¾ãˆã¦ã€å„æ™‚é–“å¸¯ã®ã€Œç›®çš„ãƒ»æ„å‘³ã€ã‚’æ¨æ¸¬ã™ã‚‹

**å…¥åŠ›**:
- `stage-06.daily-llm.json`ï¼ˆdaily_context ã¨ã—ã¦å‚ç…§ï¼‰
- `stage-05.hour-llm.jsonl`ï¼ˆå„æ™‚é–“å¸¯ã®å…ƒã®è¦ç´„ï¼‰

**å‡ºåŠ›**: `trace/2026-02-06/004450-885721/stage-07.hour-enrich-llm.jsonl`

**å‡¦ç†ã®æ„å›³**:
- hour-llmï¼ˆStep 6ï¼‰ã¯ã€Œä½•ã‚’ã—ã¦ã„ãŸã‹ã€ï¼ˆ**è¦³æ¸¬ãƒ™ãƒ¼ã‚¹**ï¼‰ã‚’è¦ç´„ã™ã‚‹
- hour-enrich-llmï¼ˆStep 8ï¼‰ã¯ã€Œ1æ—¥å…¨ä½“ã®ç›®çš„ã®ä¸­ã§ã©ã®ã‚ˆã†ãªæ„å‘³ã‚’æŒã¤ã‹ã€ï¼ˆ**æ¨æ¸¬ãƒ™ãƒ¼ã‚¹**ï¼‰ã‚’ä»˜ä¸ã™ã‚‹
- ä¸¡æ–¹ã‚’åˆ¥ã€…ã«ä¿æŒã™ã‚‹ã“ã¨ã§ã€**å…ƒã®è¦³æ¸¬ã¨æ¨æ¸¬ã‚’åŒºåˆ¥**ã—ã¦æŒ¯ã‚Šè¿”ã‚Œã‚‹
- LLMã®æ¨æ¸¬ãŒå®Ÿéš›ã®æ„å›³ã¨ç•°ãªã‚‹å ´åˆã§ã‚‚ã€å…ƒã®è¦³æ¸¬ã‹ã‚‰æŒ¯ã‚Šè¿”ã‚ŠãŒå¯èƒ½

**LLMã¸ã®æŒ‡ç¤º**:
- `hour_title_enriched`: çŸ­ãå…·ä½“çš„ï¼ˆè¡Œå‹•+ç›®çš„ï¼‰ã€‚ã‚¢ãƒ—ãƒªåã ã‘ã¯ç¦æ­¢
- `hour_summary_enriched`: 2ã€œ3æ–‡ã€‚ã€Œä½•ã‚’ã—ã¦ã„ãŸã‹ã€+ã€Œ1æ—¥å…¨ä½“ã«ãŠã‘ã‚‹æ„å‘³ã€
- æ¨æ¸¬ã¯æ§ãˆã‚ã«ï¼ˆæ ¹æ‹ ãŒ daily_context ã‚„ hours ã«ã‚ã‚‹ç¯„å›²ã§ï¼‰

```json
{
  "hours": [
    {
      "hour_start_ts": "2026-02-06T00:00:00+09:00",
      "hour_end_ts": "2026-02-06T00:59:59+09:00",
      "hour_title_enriched": "LLMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã«å‘ã‘ãŸæ–™é‡‘æƒ…å ±ã®ç¢ºèª",
      "hour_summary_enriched": "OpenAIã®æ–™é‡‘ãƒšãƒ¼ã‚¸ã‚’ç¢ºèªã—ã€LLMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã®ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Šã‚’è¡Œã£ãŸã€‚ã“ã‚Œã¯1æ—¥ã‚’é€šã˜ãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã®åœŸå°ã¨ãªã‚‹æƒ…å ±åé›†ã§ã‚ã£ãŸã€‚",
      "confidence": 0.7
    }
  ]
}
```

---

### **Step 9: æœ€çµ‚ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ç”Ÿæˆï¼ˆout/ï¼‰**

**ç›®çš„**: ãƒ«ãƒ¼ãƒ«é›†è¨ˆ + LLMçµæœï¼ˆhour/daily/hour-enrichï¼‰ã‚’çµ±åˆã—ã€äººé–“ãŒèª­ã¿ã‚„ã™ã„æ—¥å ±Markdownã«ã™ã‚‹

**å…¥åŠ›ï¼ˆä¸»ï¼‰**:
- å…ƒãƒ­ã‚°: `EVERYTIME-LOG/logs/2026-02-06.jsonl`
- ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ä¸­é–“: `stage-04.hour-pack.jsonl` ç›¸å½“ï¼ˆå†…éƒ¨ç”Ÿæˆï¼‰
- LLMå‡ºåŠ›:
  - `out/<date>/<run_id>/<date>.hourly.llm.json`ï¼ˆhour-llmã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
  - `out/<date>/<run_id>/<date>.daily.llm.json`ï¼ˆdaily-llmã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
  - `out/<date>/<run_id>/<date>.hour-enrich.llm.json`ï¼ˆhour-enrich-llmã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
  - ï¼ˆä»»æ„ï¼‰`out/<date>/<run_id>/<date>.llm.json`ï¼ˆsegment-llm / enrichï¼‰

**å‡ºåŠ›**: `EVERYTIME-LOG/out/2026-02-06/004450-885721/26-02-06_Everlogèµ·å‹•ã¨LLMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã®å…¨æ—¥æ¤œè¨.md`

**å®‰å…¨ã‚µãƒ‹ã‚¿ã‚¤ã‚ºï¼ˆé‡è¦ï¼‰**:
- Markdownæ›¸ãå‡ºã—ç›´å‰ã« `EVERLOG_SAFE_MARKDOWN` ãŒæœ‰åŠ¹ãªã‚‰ã€å…±æœ‰ã—ã¦å±é™ºã«ãªã‚Šã‚„ã™ã„æƒ…å ±ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒã‚¹ã‚¯ã™ã‚‹
- LLMã®ã€Œç”ŸæˆåŸºæº–ã«ã‚ˆã‚‹æ‹’å¦ã€ã«ä¾å­˜ã›ãšã€**æœ€çµ‚æˆæœç‰©ã«æ®‹ã•ãªã„ä¿è¨¼**ã‚’æŒã¤ãŸã‚ã®å±¤

**ãƒ˜ãƒƒãƒ€ãƒ¼ã®å½¢å¼**:
- `daily_title` ãŒã‚ã‚‹å ´åˆ: `# <yy-mm-dd>_<daily_title>`
- `daily_title` ãŒãªã„å ´åˆ: `# ä½œæ¥­ãƒ­ã‚° <date>`

**ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã®æ§‹æˆ**:
- **ä¸»ãªä½œæ¥­**: `hour_title`ï¼ˆhour-llmã®å‡ºåŠ› / è¦³æ¸¬ãƒ™ãƒ¼ã‚¹ï¼‰
- **æ¦‚è¦**: `hour_summary`ï¼ˆhour-llmã®å‡ºåŠ› / è¦³æ¸¬ãƒ™ãƒ¼ã‚¹ï¼‰
- **æ¨æ¸¬ã•ã‚Œã‚‹æ„å›³**: `hour_summary_enriched`ï¼ˆhour-enrich-llmã®å‡ºåŠ› / æ¨æ¸¬ãƒ™ãƒ¼ã‚¹ï¼‰

```markdown
# 26-02-06_Everlogèµ·å‹•ã¨LLMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã®å…¨æ—¥æ¤œè¨

- è¨˜éŒ²æœŸé–“: 00:00 ã€œ 23:57ï¼ˆç´„23æ™‚é–“56åˆ†ï¼‰
- ã‚­ãƒ£ãƒ—ãƒãƒ£æ•°: 187å›ï¼ˆæœ‰åŠ¹ 184 / é™¤å¤– 1 / å¤±æ•— 2ï¼‰
- æ¨å®šç·æ™‚é–“: 11æ™‚é–“59åˆ†ï¼ˆæœ‰åŠ¹åˆ†ã®ã¿ï¼‰ / 12æ™‚é–“14åˆ†ï¼ˆé™¤å¤–ãƒ»å¤±æ•—ã‚‚å«ã‚€ï¼‰
- LLMä½¿ç”¨é‡ï¼ˆå†…è¨³ï¼‰:
  - hour-llmï¼ˆã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ç”¨ï¼‰: ...
  - daily-llmï¼ˆç·æ‹¬ç”¨ï¼‰: ...
  - hour-enrich-llmï¼ˆæ„å›³æ¨æ¸¬ç”¨ï¼‰: ...
  - åˆè¨ˆ: ...

## æœ¬æ—¥ã®ãƒ¡ã‚¤ãƒ³ä½œæ¥­ï¼ˆç·æ‹¬ï¼‰

- æ¨å®š: Everlogèµ·å‹•ã¨LLMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã®å…¨æ—¥æ¤œè¨
- æ¦‚è¦: æœ¬æ—¥ã€Everlogã®èµ·å‹•ç¢ºèªã¨ãƒ­ã‚°åé›†åŸºç›¤ã®æ•´ç†ã‹ã‚‰ä½œæ¥­ã‚’é–‹å§‹ã—ãŸã€‚...

## ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ï¼ˆæ¨å®šãƒ»1æ™‚é–“ï¼‰

### 00:00ã€œ00:59ï¼ˆæ¨å®šç¨¼åƒ: 12åˆ†ï¼‰

- ä¸»ãªä½œæ¥­: Everlogèµ·å‹•ã¨åˆæœŸç¢ºèª
- æ¦‚è¦: ãƒ­ã‚°æ©Ÿæ§‹ã®èµ·å‹•ã¨Everlogæœ¬ä½“ã®é…ç½®å ´æ‰€ã‚’ç¢ºèªã™ã‚‹ä½œæ¥­ã‚’é€²ã‚ãŸã€‚...
- ä¸»ãªä½œæ¥­ç”»é¢: Finder, Google Chrome
- æ¨æ¸¬ã•ã‚Œã‚‹æ„å›³: LLMãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã«å‘ã‘ãŸæ–™é‡‘æƒ…å ±ã®ç¢ºèªã€‚1æ—¥ã‚’é€šã˜ãŸãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­è¨ˆã®åœŸå°ã¨ãªã‚‹æƒ…å ±åé›†ã§ã‚ã£ãŸã€‚
```

---

## ğŸ§­ ãƒˆãƒ¬ãƒ¼ã‚¹å‡ºåŠ›åˆ¶å¾¡ï¼ˆæœ€å°ã‚»ãƒƒãƒˆï¼‰

ç’°å¢ƒå¤‰æ•° `EVERLOG_TRACE_STAGE_MAX`ï¼ˆã¾ãŸã¯ `EVERYTIMECAPTURE_TRACE_STAGE_MAX`ï¼‰ã§ã€ã©ã“ã¾ã§ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’æ›¸ãå‡ºã™ã‹ã‚’åˆ¶å¾¡ã§ãã¾ã™ã€‚

- `EVERLOG_TRACE_STAGE_MAX=2`:
  - `run.json`, `stage-00.raw.jsonl`, `stage-01.entities.jsonl`, `stage-02.segment.jsonl`
- `EVERLOG_TRACE_STAGE_MAX=3`:
  - `stage-03.segment.jsonl` ã¾ã§
- `EVERLOG_TRACE_STAGE_MAX=4`:
  - `stage-04.hour-pack.jsonl` ã¾ã§
- `EVERLOG_TRACE_STAGE_MAX=5`:
  - `stage-05.hour-llm.jsonl` ã¾ã§
- `EVERLOG_TRACE_STAGE_MAX=6`:
  - `stage-06.daily-llm.json` ã¾ã§
- `EVERLOG_TRACE_STAGE_MAX=7`:
  - `stage-07.hour-enrich-llm.jsonl` ã¾ã§

---

## ğŸ“Š å®Œå…¨ãªãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆï¼ˆPIPLINE_3ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    logs/YYYY-MM-DD.jsonl (å…ƒãƒ‡ãƒ¼ã‚¿ / captureå‡ºåŠ›)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: stage-00.raw.jsonl                                                  â”‚
â”‚  â””â”€â”€ eventã‚­ãƒ¼ã§ãƒ©ãƒƒãƒ—ã—ã¦ä¿å­˜ï¼ˆæ¤œè¨¼ç”¨ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼‰                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: stage-01.entities.jsonl                                             â”‚
â”‚  â””â”€â”€ active-firstç‰¹å¾´æŠ½å‡º + ocr_by_displayä¿æŒï¼ˆdisplayåˆ¥OCRã‚’æ®‹ã™ï¼‰          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: stage-02.segment.jsonl                                              â”‚
â”‚  â””â”€â”€ ã‚»ã‚°ãƒ¡ãƒ³ãƒˆä»˜ä¸ï¼ˆsegment_id / segment_labelï¼‰                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: stage-03.segment.jsonl                                              â”‚
â”‚  â””â”€â”€ segmentå†…OCRçµ±åˆï¼ˆæ–‡/è¡Œå˜ä½ã§é‡è¤‡é™¤å» + common_textsåˆ†é›¢ï¼‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: stage-04.hour-pack.jsonl                                            â”‚
â”‚  â””â”€â”€ 1æ™‚é–“ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆhour_common_texts + clusters/top3 + active_timelineï¼‰  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 6: stage-05.hour-llm.jsonl                                             â”‚
â”‚  â””â”€â”€ 1æ™‚é–“è¦ç´„ï¼ˆLLM: hour_title/hour_summary/hour_detail...ï¼‰ã€è¦³æ¸¬ãƒ™ãƒ¼ã‚¹ã€‘   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 7: stage-06.daily-llm.json                                             â”‚
â”‚  â””â”€â”€ 1æ—¥ç·æ‹¬ï¼ˆLLM: daily_title/daily_summary/highlights...ï¼‰                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 8: stage-07.hour-enrich-llm.jsonl                                      â”‚
â”‚  â””â”€â”€ æ™‚é–“å¸¯ã®ç›®çš„ãƒ»æ„å‘³ã®å†è§£é‡ˆï¼ˆLLM: hour_title_enriched/hour_summary_...ï¼‰ â”‚
â”‚      ã€daily_contextã‚’è¸ã¾ãˆãŸæ¨æ¸¬ãƒ™ãƒ¼ã‚¹ã€‘                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 9: out/<date>/<run_id>/<yy-mm-dd_daily_title>.md                       â”‚
â”‚  â””â”€â”€ æ—¥å ±Markdownï¼ˆçµ±è¨ˆ + hourè¦ç´„ + dailyè¦ç´„ + æ¨æ¸¬ã•ã‚Œã‚‹æ„å›³ï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ã‚¹ãƒ†ãƒ¼ã‚¸åã¨ç•ªå·ã®å¯¾å¿œè¡¨ï¼ˆPIPLINE_3ï¼‰

| ãƒ•ã‚¡ã‚¤ãƒ«å | Step | å‡¦ç†å†…å®¹ | ä¸»ãªç”Ÿæˆå…ƒ |
|---|---:|---|---|
| `run.json` | 0 | ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ | summarize |
| `stage-00.raw.jsonl` | 1 | ç”Ÿãƒ‡ãƒ¼ã‚¿ä¿å­˜ï¼ˆeventãƒ©ãƒƒãƒ—ï¼‰ | summarize |
| `stage-01.entities.jsonl` | 2 | ç‰¹å¾´æŠ½å‡ºï¼ˆactive-first + ocr_by_displayä¿æŒï¼‰ | summarize |
| `stage-02.segment.jsonl` | 3 | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆä»˜ä¸ï¼ˆsegment_id/labelï¼‰ | summarize |
| `stage-03.segment.jsonl` | 4 | ã‚»ã‚°ãƒ¡ãƒ³ãƒˆå†…OCRçµ±åˆï¼ˆé‡è¤‡é™¤å» + common_textsï¼‰ | summarize |
| `stage-04.hour-pack.jsonl` | 5 | 1æ™‚é–“ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆLLMå…¥åŠ›ï¼‰ | summarize |
| `stage-05.hour-llm.jsonl` | 6 | 1æ™‚é–“LLMè¦ç´„ï¼ˆè¦³æ¸¬ãƒ™ãƒ¼ã‚¹ï¼‰ | summarizeï¼ˆLLMæœ‰åŠ¹æ™‚ï¼‰ |
| `stage-06.daily-llm.json` | 7 | 1æ—¥LLMç·æ‹¬ | summarizeï¼ˆLLMæœ‰åŠ¹æ™‚ï¼‰ |
| `stage-07.hour-enrich-llm.jsonl` | 8 | æ™‚é–“å¸¯ã®ç›®çš„ãƒ»æ„å‘³ã®å†è§£é‡ˆï¼ˆæ¨æ¸¬ãƒ™ãƒ¼ã‚¹ï¼‰ | summarizeï¼ˆLLMæœ‰åŠ¹æ™‚ï¼‰ |
| `out/<date>/<run_id>/<yy-mm-dd_title>.md` | 9 | æœ€çµ‚ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ | summarize |

### LLMã‚¹ãƒ†ãƒ¼ã‚¸ã®å½¹å‰²åˆ†æ‹…

| ã‚¹ãƒ†ãƒ¼ã‚¸ | å½¹å‰² | å…¥åŠ› | å‡ºåŠ›ã®ç‰¹å¾´ |
|---|---|---|---|
| hour-llm (Step 6) | ã€Œä½•ã‚’ã—ã¦ã„ãŸã‹ã€ã‚’è¦ç´„ | hour-pack | è¦³æ¸¬ãƒ™ãƒ¼ã‚¹ã€‚OCRãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰æ¨æ¸¬ |
| daily-llm (Step 7) | ã€Œ1æ—¥å…¨ä½“ã®æµã‚Œã€ã‚’ç·æ‹¬ | hour-llmå…¨ä½“ | å…¨ä½“åƒã®æŠŠæ¡ |
| hour-enrich-llm (Step 8) | ã€Œå„æ™‚é–“å¸¯ã®ç›®çš„ãƒ»æ„å‘³ã€ã‚’æ¨æ¸¬ | daily-llm + hour-llm | æ¨æ¸¬ãƒ™ãƒ¼ã‚¹ã€‚daily_contextã‚’è¸ã¾ãˆã¦è§£é‡ˆ |

**è¨­è¨ˆæ„å›³**: hour-llmã¨hour-enrich-llmã‚’åˆ†é›¢ã™ã‚‹ã“ã¨ã§ã€ã€Œå…ƒã®è¦³æ¸¬ã€ã¨ã€ŒLLMã®æ¨æ¸¬ã€ã‚’åŒºåˆ¥ã—ã¦æŒ¯ã‚Šè¿”ã‚Œã‚‹ã€‚LLMã®æ¨æ¸¬ãŒå®Ÿéš›ã®æ„å›³ã¨ç•°ãªã‚‹å ´åˆã§ã‚‚ã€å…ƒã®è¦³æ¸¬ã‹ã‚‰ä½œæ¥­å†…å®¹ã‚’æ€ã„å‡ºã›ã‚‹ã€‚

